# Stats Service

## Назначение
Сервис отвечает за сбор, обработку и предоставление аналитических данных о пользовательской активности, просмотрах постов и популярности контента.

## Зоны ответственности
1. **Аналитика постов**:
   - Сбор статистики просмотров, лайков и комментариев
   - Расчет популярности контента
   - Формирование трендов

2. **Аналитика пользователей**:
   - Отслеживание активности пользователей
   - Подсчет созданных постов и комментариев
   - Анализ вовлеченности

3. **Реал-тайм отчеты**:
   - Генерация топ-постов
   - Мониторинг активных пользователей
   - Агрегация данных в реальном времени

## Границы сервиса

### Входящие взаимодействия:
| Источник       | Протокол          | Назначение |
|----------------|-------------------|------------|
| Kafka          | Event Streaming   | Получение событий (просмотры, лайки) |
| API Gateway    | REST              | Запросы аналитических отчетов |

### Исходящие взаимодействия:
| Целевой сервис | Протокол | Назначение |
|----------------|----------|------------|
| -              | -        | Сервис не инициирует исходящие вызовы |

### Что НЕ входит в обязанности:
- Хранение первичных данных о постах или пользователях
- Управление контентом
- Аутентификация пользователей
- Формирование ленты новостей

## Технологический стек
- **Язык**: Go/Python
- **База данных**: ClickHouse
- **Интеграции**:
  - Kafka для входящих событий
- **API**:
  ```http
  GET /stats/posts/{id} - Статистика по конкретному посту
  GET /stats/top-posts - Топ популярных постов
  GET /stats/user-activity/{user_id} - Активность пользователя
  ```
## Модель данных
**Основные сущности:**

**Статистика постов (post_stats):**  
- Идентификатор поста (UUID)  
- Количество просмотров  
- Количество лайков  
- Количество комментариев  
- Время первого просмотра  
- Время последнего просмотра  

**Активность пользователей (user_activity):**  
- Идентификатор пользователя (UUID)  
- Дата активности  
- Создано постов  
- Добавлено комментариев  
- Поставлено лайков  

**Популярные посты (popular_posts):**  
- Дата ранжирования  
- Позиция в топе  
- Идентификатор поста  
- Балл популярности  
- Коэффициент роста (trend_score)

## Особенности реализации
- Обработка данных: Потоковая обработка через Kafka Consumer
- Хранилище: Column-oriented база данных (ClickHouse)
- Оптимизации:
    - Материализованные представления для частых запросов
    - Пакетная вставка данных
- Масштабирование: Шардирование по датам

## Требования к окружению
- ClickHouse 22.3+
- Go 1.18+ / Python 3.10+
- Kafka 2.8+
