# User Service

## Назначение
Сервис отвечает за управление учетными записями пользователей, аутентификацию, авторизацию и управление ролями в системе.

## Зоны ответственности
1. **Регистрация и аутентификация**:
   - Создание новых учетных записей
   - Вход в систему (JWT/OAuth)
   - Восстановление пароля
   - Управление сессиями

2. **Управление профилями**:
   - Редактирование личных данных
   - Управление настройками приватности
   - Верификация email

3. **Управление ролями и правами**:
   - Создание и назначение ролей
   - Проверка прав доступа
   - Аудит действий пользователей

## Границы сервиса

### Входящие взаимодействия:
| Источник       | Протокол    | Назначение |
|----------------|-------------|------------|
| API Gateway    | REST/gRPC   | Запросы управления пользователями |
| Post Service   | gRPC        | Проверка существования пользователя |
| Stats Service  | gRPC        | Получение данных для аналитики активности |

### Исходящие взаимодействия:
| Целевой сервис | Протокол | Назначение |
|----------------|----------|------------|
| Kafka          | Events   | Отправка событий регистрации/изменений |
| Email Service  | gRPC     | Отправка верификационных писем |

### Что НЕ входит в обязанности:
- Хранение контента пользователей (посты, комментарии)
- Аналитика активности
- Управление медиаконтентом
- Формирование ленты новостей

## Технологический стек
- **Язык**: Java/Python/Go
- **База данных**: PostgreSQL
- **Безопасность**:
  - BCrypt для хеширования паролей
  - JWT для аутентификации
- **API**:
  ```http
  POST /register - Регистрация нового пользователя
  POST /login - Аутентификация
  GET /users/{id} - Получение профиля
  PUT /users/{id} - Обновление профиля
  GET /users/{id}/roles - Получение ролей пользователя
  ```
## Модель данных
### Основные сущности:
Пользователи (users):
- Идентификатор (UUID)
- Логин (уникальный)
- Email
- Хеш пароля
- Дата создания
- Дата обновления
- Флаг активности

Роли (roles):
- Идентификатор (UUID)
- Название роли
- Описание роли
- Дата создания
- Флаг роли по умолчанию

Связи пользователей и ролей (user_roles):
- Идентификатор пользователя
- Идентификатор роли
- Дата назначения
  
## Особенности реализации
- Аутентификация: OAuth 2.0 и JWT
- Валидация: Проверка уникальности email и логина
- Безопасность:
  - Защита от brute-force атак
  - Автоматическая блокировка после N попыток
- Кэширование: Redis для частых запросов профилей
- Миграции: Flyway (Java) или SQLAlchemy (Python)

## Требования к окружению
- PostgreSQL 14+
- Java 17+ / Python 3.10+ / Go 1.20+
- Kafka 3.0+ (для событийной модели)
